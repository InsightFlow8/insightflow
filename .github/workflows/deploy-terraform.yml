name: Deploy Terraform S3 Bucket  # å·¥ä½œæµåç§°ï¼Œä¼šæ˜¾ç¤ºåœ¨ GitHub Actions é¡µé¢ä¸Š

# è§¦å‘æ–¹å¼ï¼šæ‰‹åŠ¨è§¦å‘
on:
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy to AWS  # Job åç§°
    runs-on: ubuntu-latest  # æŒ‡å®š runner é•œåƒ

    steps:
      - name: ğŸ“¥ Checkout repository  # ç¬¬ä¸€æ­¥ï¼šæŠŠä»“åº“ä»£ç æ£€å‡ºåˆ° runner æœ¬åœ°
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Terraform  # ç¬¬äºŒæ­¥ï¼šå®‰è£… Terraform ç¯å¢ƒ
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.8.5  # æŒ‡å®š Terraform ç‰ˆæœ¬

      - name: ğŸ“‘ Terraform Init  # ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ– Terraformï¼ˆä¸‹è½½ provider æ’ä»¶ç­‰ï¼‰
        run: terraform init
        working-directory: .terraform  # æŒ‡å®š Terraform é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•

      - name: âœ… Terraform Validate  # ç¬¬å››æ­¥ï¼šæ£€æŸ¥ Terraform é…ç½®æ–‡ä»¶è¯­æ³•å’Œåˆæ³•æ€§
        run: terraform validate
        working-directory: .terraform

      - name: ğŸ“¤ Terraform Apply  # ç¬¬äº”æ­¥ï¼šæ‰§è¡Œéƒ¨ç½²ï¼ˆapplyï¼‰
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}  # ä» GitHub Secrets è·å– AWS Access Key
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}  # ä» Secrets è·å– Secret Key
        run: |
          terraform apply -auto-approve \  # æ‰§è¡Œ applyï¼Œè‡ªåŠ¨ç¡®è®¤
            -var "aws_access_key=$AWS_ACCESS_KEY_ID" \  # ä¼ å…¥ AWS Access Key
            -var "aws_secret_key=$AWS_SECRET_ACCESS_KEY"  # ä¼ å…¥ AWS Secret Key
        working-directory: .terraform  # æŒ‡å®š Terraform é…ç½®æ–‡ä»¶ç›®å½•

