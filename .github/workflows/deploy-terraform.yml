

name: Deploy Terraform S3 Bucket


on:
  workflow_dispatch:

jobs:
  deploy:

    name: Deploy to AWS  # Job åç§°
    runs-on: ubuntu-latest  # æŒ‡å®š runner é•œåƒ

    steps:
      - name: ğŸ“¥ Checkout repository  # ç¬¬ä¸€æ­¥ï¼šæŠŠä»“åº“ä»£ç æ£€å‡ºåˆ° runner æœ¬åœ°
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Terraform  # ç¬¬äºŒæ­¥ï¼šå®‰è£… Terraform ç¯å¢ƒ
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.8.5  # æŒ‡å®š Terraform ç‰ˆæœ¬

      - name: ğŸ“‘ Terraform Init
        id: init
        run: terraform init
        working-directory: terraform/dev

      - name: âœ… Terraform Validate
        id: validate
        run: terraform validate -no-color
        working-directory: terraform/dev

      - name: ğŸ“¤ Terraform Apply
        id: apply
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          TF_VAR_snowflake_user: ${{ secrets.SNOWFLAKE_USER }}
          TF_VAR_snowflake_password: ${{ secrets.SNOWFLAKE_PASSWORD }}
          TF_VAR_snowflake_account: ${{ secrets.SNOWFLAKE_ACCOUNT }}
          TF_VAR_snowflake_warehouse: ${{ secrets.SNOWFLAKE_WAREHOUSE }}
          TF_VAR_snowflake_role: ${{ secrets.SNOWFLAKE_ROLE }}
          TF_VAR_db_password: ${{ secrets.DB_PASSWORD }}
        run: |
          terraform apply -auto-approve -var-file="terraform.tfvars.json"
        working-directory: terraform/dev


